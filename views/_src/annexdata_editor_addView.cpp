#include <QtCore>
#include <TreeFrogView>
#include "annexdata.h" 
#include "applicationhelper.h"

class T_VIEW_EXPORT annexdata_editor_addView : public TActionView
{
  Q_OBJECT
public:
  annexdata_editor_addView() : TActionView() { }
  QString toString();
};

QString annexdata_editor_addView::toString()
{
  responsebody.reserve(30459);
  responsebody += QStringLiteral("<!DOCTYPE html>\n");
    responsebody += QStringLiteral("<html>\n<head>\n  <meta charset=\"UTF-8\">\n  <html lang=\"de\">\n\n  <title>");
  responsebody += THttpUtility::htmlEscape(controller()->name() + ": " + controller()->activeAction());
  responsebody += QStringLiteral("</title>\n\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0, user-scalable=yes\">\n  \n  <link rel=\"icon\" type=\"image/svg+xml\" href=\"/favicon.svg\">\n  <link rel=\"alternate icon\" href=\"/favicon.ico\">\n  <link rel=\"mask-icon\" href=\"/favicon.svg\" color=\"#b2b2b2\">\n\n  <script>\n    function doLocal()\n    {\n        console.log(\"this is local\");\n\n        let l_footer = document.getElementById(\"itisFooter\");\n        l_footer.message = '<a href=\"/stdsystem/license\" title=\"licenses\">Lizenzen</a>&nbsp;<a href=\"/stdsystem/imprint\" title=\"Impressum\">Imprint</a>';\n\n        getObjects(");
  techoex(jsonObjects);
  responsebody += QStringLiteral(");\n        getCategories(");
  techoex(jsonCategories);
  responsebody += QStringLiteral(");\n        getLanguages(");
  techoex(jsonLanguages);
  responsebody += QStringLiteral(");\n        getAcClasses(");
  techoex(jsonAcClasses);
  responsebody += QStringLiteral(");\n        getPcClasses(");
  techoex(jsonPcClasses);
  responsebody += QStringLiteral(");\n        getReleaseTypes(");
  techoex(jsonReleaseTypes);
  responsebody += QStringLiteral(");\n        setSpecValidDate();\n        \n        document.getElementById(\"releases\").selectedIndex = \"0\";\n        document.getElementById(\"releases\").disabled = true;\n        document.getElementById(\"lfdnr\").addEventListener(\"click\", function(){ document.getElementById('checkLfdnrImg').removeAttribute(\"class\"); document.getElementById('checkLfdnrImg').setAttribute(\"src\", \"/Icons/question.svg\");});\n		getNextLfdnr();\n    }\n\n	function setLanguage(lang)\n	{\n		if(lang == \"0\")	{lang = \"de\";}\n		else {lang = \"en\";}\n		document.cookie = \"lang=\" + lang + \";\" + \";path=/\";\n		location.reload();\n	}\n	\n  </script>\n\n  <script type=\"module\" src=\"/js/itis_init.js\" /></script>\n  <link rel=\"stylesheet\" href=\"/css/w3.css\">  \n  <link rel=\"stylesheet\" href=\"/css/custom.css\">\n\n  <script src=\"/js/annex/annex_editor.js\" /></script>\n\n	<style>\n   .card {\n      background-color: #fff;\n      border-radius: 0.5rem;\n      box-shadow: 0.05rem 0.1rem 0.3rem -0.03rem rgba(0, 0, 0, 0.45);\n      padding-bottom: 1rem;\n    }\n\n    .card > :last-child {\n      margin-bottom: 0;\n    }\n\n    .card h3 {\n      margin-top: 1rem;\n      font-size: 1.25rem;\n    }\n\n    img.imggal {\n      border-radius: 0.5rem 0.5rem 0 0;\n      width: 100%;\n    }\n\n    img.imggal ~ * {\n      margin-left: 1rem;\n      margin-right: 1rem;\n    }\n\n    .card-wrapper {\n    list-style: none;\n    padding: 0;\n    margin: 0;\n    display: grid;\n    grid-template-columns: repeat(auto-fit, minmax(30ch, 1fr));\n    grid-gap: 1.5rem;\n  }\n  \n	</style>   \n\n</head>\n\n<body class=\"w3-container w3-margin\" id=\"body\">\n\n  <itis-menu id=\"itisMenu\" message=\"\"></itis-menu>\n\n  <div class=\"w3-container w3-light-blue\">\n    <h2 id=\"portaltitle\">ITIS-API::Admin-Portal</h2>\n  </div>\n\n  <itis-menusub id=\"itisMenuSub\" message=\"");
  responsebody += THttpUtility::htmlEscape(controller()->name());
  responsebody += QStringLiteral("\"></itis-menusub>\n\n<h3 id=\"pagetitle\"><page-title message=\"\">");
  responsebody += THttpUtility::htmlEscape(controller()->name() + ": " + controller()->activeAction());
  responsebody += QStringLiteral("</page-title></h3>\n	<div id=\"pagedesc\"><page-desc message=\"\"></page-desc></div>\n\n<p style=\"color: red\"><span  id=\"redmsg\">");
  techoex(red_msg);
  responsebody += QStringLiteral("</span> ");
  tehex(error);
  responsebody += QStringLiteral("</p><p style=\"color: green\"><span id=\"greenmsg\">");
  techoex(green_msg);
  responsebody += QStringLiteral("</span> ");
  tehex(notice);
  responsebody += QStringLiteral("</p>\n\n<div id=\"test\" style=\"display: none;\" class=\"w3-modal\">\n    <div class=\"w3-modal-content\">\n      <div class=\"w3-container\">\n        <span onclick=\"document.getElementById('test').style.display='none'\" class=\"w3-button w3-display-topright\">&times;</span>\n        <span id=\"msg\"></span>\n      </div>\n    </div>\n  </div>\n</div>\n\n\n<main>\n<div id=\"pagecontent\"><page-content message=\"\"></page-content></div>\n\n     <form id=\"addSpec\" action=\"javascript:void(0);\">\n        <section style=\"border-radius: 0.5em 0.5em 0px 0px;\">\n            <div class=\"w3-cell-row\">\n                <div class=\"w3-container w3-cell\">\n                    <span class=\"w3-tooltip\">\n                        <label for=\"spec_title\">Titel:&nbsp;</label><br><input type=\"text\" id=\"spec_title\" name=\"spec_title\" maxlength=\"100\" style=\"width:80%\" required>\n                    <span style=\"position:absolute;left:0;bottom:18px\" class=\"w3-text w3-tag\">Baustein-Titel, Verwendung im Inhaltsverzeichnis</span>\n                    <br>\n                </div>\n                <div class=\"w3-container w3-cell\">\n                    <span class=\"w3-tooltip\">\n                        <label for=\"spec_desc\">Beschreibung:&nbsp;</label><br><input type=\"text\" id=\"spec_desc\" name=\"spec_desc\" maxlength=\"100\" style=\"width:80%\" required>\n                    <span style=\"position:absolute;left:0;bottom:18px\" class=\"w3-text w3-tag\">Kurzbeschreibung f&uuml;r Text-Baustein Administration</span>\n                    <br>\n                </div>\n            </div>\n            <br>\n            <div class=\"w3-cell-row\">\n                <fieldset id=\"fsobjects\"><legend>Objekt-Zuordnung</legend>\n                    <div class=\"w3-container w3-cell\">\n						<button onclick=\"toggleObjCheckboxes('objects')\" type=\"button\" id=\"btnObj\">toggle:</button>&nbsp;\n                        <span class=\"w3-tooltip\">\n                            <span id=\"objects\"></span>\n                        <span style=\"position:absolute;left:0;bottom:18px\" class=\"w3-text w3-tag\">Ein oder mehrere Objekte</span></span>\n                        <br>\n                    </div>\n                </fieldset>\n            </div>\n            <br>\n            \n            <div class=\"w3-cell-row\">\n                <fieldset><legend>Objekt-Attribute</legend>\n                    <div class=\"w3-container w3-cell\">\n                        <label for=\"cat\">Kategorie:&nbsp;</label><br><select name=\"cat\" id=\"cat\"></select>\n                        <br>\n                    </div>\n                    <div class=\"w3-container w3-cell\">\n                        <span class=\"w3-tooltip\">\n                            <label for=\"country\">Land:&nbsp;</label><br><input type=\"text\" id=\"country\" name=\"country\" minlength=\"2\" maxlength=\"2\" size=\"5\" placeholder=\"WW\" value=\"WW\" required>\n                        <span style=\"position:absolute;left:0;bottom:18px\" class=\"w3-text w3-tag\">2-stelliger L&auml;ndercode (WW = World Wide)</span>\n                        <br>\n                    </div>\n                    <div class=\"w3-container w3-cell\">\n                        <label for=\"lang\">Sprache:&nbsp;</label><br><select name=\"lang\" id=\"lang\"></select>\n                        <br>\n                    </div>\n                    <div class=\"w3-container w3-cell\">\n                        <span class=\"w3-tooltip\">\n                            <label for=\"spec_version\">Version:&nbsp;</label><br><input type=\"text\" id=\"spec_version\" name=\"spec_version\" minlength=\"9\" maxlength=\"9\" size=\"10\" placeholder=\"v00.00.00\" value=\"v00.00.01\" required>\n                        <span style=\"position:absolute;left:0;bottom:18px\" class=\"w3-text w3-tag\">Text-Baustein Version (Bsp.: v00.01.02)</span>\n                        <br>\n                    </div>\n                    <div class=\"w3-container w3-cell\">\n                        <span class=\"w3-tooltip\">\n                            <label for=\"lfdnr\">lfdnr:&nbsp;</label><br><input type=\"number\" id=\"lfdnr\" name=\"lfdnr\" minlength=\"3\" maxlength=\"3\" size=\"10\" placeholder=\"099\" required>\n							<span style=\"position:absolute;left:0;bottom:18px\" class=\"w3-text w3-tag\">3-stellige Text-Baustein Nummerierung (Bsp.: 013)</span>\n                        </span>\n                        <span class=\"w3-tooltip\">\n							<span style=\"position:absolute;left:0;bottom:18px\" class=\"w3-text w3-tag\">check lfdnr innerhalb der gew&auml;hlten Cat</span>\n                        &nbsp;<img id=\"checkLfdnrImg\" src=\"/Icons/question.svg\" onclick=\"checkLfdnr()\" onmouseover=\"style='cursor: pointer;'\">&nbsp;<span id=\"lfdnrErg\" class=\"w3-tag\">\n						</span>\n                        <br>\n                    </div>\n                    <div class=\"w3-container w3-cell\">\n                        <span class=\"w3-tooltip\">\n                            <label for=\"comment\">interner Kommentar:&nbsp;</label><br><input type=\"text\" id=\"comment\" name=\"comment\" maxlength=\"200\" style=\"width:100%\">\n                        <span style=\"position:absolute;left:0;bottom:18px\" class=\"w3-text w3-tag\">optional: interne Bemerkung, auch f&uuml;r Release</span>\n                        <br>\n                    </div>\n                    <div class=\"w3-container w3-cell\">\n                        <span class=\"w3-tooltip\">\n                            <label for=\"marker\">Marker:&nbsp;</label><br>\n								<select id=\"marker\" name=\"marker\">\n								  <option value=\"nomark\">---</option>\n								  <option value=\"green\" class=\"w3-opacity w3-light-green\">gr&uuml;n</option>\n								  <option value=\"yellow\" class=\"w3-opacity w3-yellow\">gelb</option>\n								  <option value=\"red\" class=\"w3-opacity w3-deep-orange\">rot</option>\n								</select>\n                        <span style=\"position:absolute;left:0;bottom:18px\" class=\"w3-text w3-tag\">interne Hilfs-Markierung</span>\n                        <br>\n                    </div>\n                </fieldset>\n            </div>\n            <br>\n            <div class=\"w3-cell-row\">\n                <div class=\"w3-container w3-cell\">\n                    <fieldset id=\"fsac_classes\"><legend>Availability Class</legend>\n                        <button onclick=\"toggleCheckboxes('ac_class')\" type=\"button\" id=\"btnAc\">toggle:</button>&nbsp;\n                        <span class=\"w3-tooltip\">\n                            <span id=\"ac_classes\"></span>\n                        <span style=\"position:absolute;left:0;bottom:18px\" class=\"w3-text w3-tag\">Eine oder mehrere AC. AC-0 nur mit Obj/Kat &quot;Allgemein&quot;</span> </span>\n                    </fieldset>\n                    <br>\n                </div>\n                <div class=\"w3-container w3-cell\">\n                    <fieldset id=\"fspc_classes\"><legend>Protection Class</legend>\n                        <button onclick=\"toggleCheckboxes('pc_class')\" type=\"button\" id=\"btnPc\">toggle:</button>&nbsp;\n                        <span class=\"w3-tooltip\">\n                            <span id=\"pc_classes\"></span>\n                        <span style=\"position:absolute;left:0;bottom:18px\" class=\"w3-text w3-tag\">Eine oder mehrere PC. PC-0 nur mit Obj/Kat &quot;Allgemein&quot;</span> </span>\n                    </fieldset>\n                    <br>\n                </div>\n                <div class=\"w3-container w3-cell\">\n                    <fieldset><legend>Legacy</legend>\n                        <span class=\"w3-tooltip\">\n                            <label><input type=\"checkbox\" name=\"legacy\" id=\"G2\">&nbsp;G2</label>\n                            <label><input type=\"checkbox\" name=\"legacy\" id=\"G3\">&nbsp;G3</label>\n                        <span style=\"position:absolute;left:0;bottom:18px\" class=\"w3-text w3-tag\">ehemals G2 od. G3</span> </span>\n                        <br>\n                     </fieldset>\n                </div>\n            </div>\n\n            <div class=\"w3-cell-row\">\n                <fieldset><legend>Text-Baustein</legend>\n                    <div class=\"w3-container w3-cell\">\n                        <label for=\"releases\">Release:&nbsp;</label><br><select name=\"releases\" id=\"releases\"></select>\n                        <br>\n                    </div>\n                    <div class=\"w3-container w3-cell\">\n                        <span class=\"w3-tooltip\">\n                            <label for=\"spec_valid_start\">g&uuml;ltig von:&nbsp;</label><br>\n                            <input type=\"date\" id=\"spec_valid_start\" name=\"spec_valid_start\" disabled>\n                        <span style=\"position:absolute;left:0;bottom:18px\" class=\"w3-text w3-tag\">Start-Datum</span> </span>\n                        <br>\n                    </div>\n                    <div class=\"w3-container w3-cell\">\n                        <span class=\"w3-tooltip\">\n                            <label for=\"spec_valid_end\">g&uuml;ltig bis:&nbsp;</label><br><input type=\"date\" id=\"spec_valid_end\" name=\"spec_valid_end\" disabled>\n                        <span style=\"position:absolute;left:0;bottom:18px\" class=\"w3-text w3-tag\">vorl&auml;ufiges End-Datum</span> </span>\n                    </div>\n                    <div class=\"w3-container w3-cell\">\n                        <br>\n                        <span class=\"w3-tooltip\">\n                            <label><input type=\"checkbox\" name=\"spec_active\" id=\"spec_active\" checked>&nbsp;aktiv</label>\n                        <span style=\"position:absolute;left:0;bottom:18px\" class=\"w3-text w3-tag\">Baustein aktiv oder in-aktiv</span> </span>\n                        <br>\n                    </div>\n                    <div class=\"w3-container w3-cell\">\n                            <label for=\"last_editor\">Autor:&nbsp;</label><br><input type=\"text\" id=\"last_editor\" name=\"last_editor\" value=\"");
  tehex(userMail);
  responsebody += tr("\" disabled style=\"width:80%\">\n                        <br>\n                    </div>\n                    <div class=\"w3-container w3-cell\">\n                        <span class=\"w3-tooltip\">\n                            <label for=\"resp\">Verantwortlich:&nbsp;</label><br><input type=\"text\" id=\"resp\" name=\"resp\" maxlength=\"200\" style=\"width:100%\">\n                        <span style=\"position:absolute;left:0;bottom:18px\" class=\"w3-text w3-tag\">Verantwortlicher: email, Abteilung, Jira-Key</span>\n                        <br>\n                    </div>\n                </fieldset>\n            </div>\n        </section>\n\n<p><input type=\"submit\" class=\"w3-btn w3-light-grey w3-border w3-border-grey\" id=\"speichern\" value=\"speichern &raquo;\" title=\"Baustein speichern\">\n<input type=\"button\" class=\"w3-btn w3-light-grey w3-right w3-border w3-border-grey\" id=\"intlinks\" title=\"internal Links\" value=\"Kapitel-Links\"></p>\n\n        <textarea name=\"content\" id=\"editor\" class=\"editor\">\n			&lt;h1&gt;Titel = &Uuml;berschrift&lt;/h1&gt; &lt;br/&gt;\n        </textarea>\n    </form>\n<p><input type=\"submit\" class=\"w3-btn w3-light-grey w3-border w3-border-grey\" id=\"submit\" value=\"speichern &raquo;\" title=\"Baustein speichern\"></p>\n\n<dialog id=\"dialog\" style=\"border-color: grey;\">\n	<form>\n		<label id=\"spec_title\">interne lfdnr-Range und Kapitel-Links</label></br>\n		<textarea id=\"user_comment\" class=\"editor\" rows=\"14\" cols=\"50\" readonly>\n			\n			100 &nbsp;&nbsp;&nbsp; #General\n			150 &nbsp;&nbsp;&nbsp; #Planning\n			200 &nbsp;&nbsp;&nbsp; #Environment\n			300 &nbsp;&nbsp;&nbsp; #Construction\n			400 &nbsp;&nbsp;&nbsp; #Power\n			450 &nbsp;&nbsp;&nbsp; #EMV\n			500 &nbsp;&nbsp;&nbsp; #Cabling\n			600 &nbsp;&nbsp;&nbsp; #Safety\n			700 &nbsp;&nbsp;&nbsp; #Security\n			800 &nbsp;&nbsp;&nbsp; #Management\n			900 &nbsp;&nbsp;&nbsp; #Operations\n			\n		</textarea>\n	</form>\n    <button id=\"close-dialog\">schließen</button>\n</dialog>\n\n<script src=\"/js/ckedit5/22.0.0/ckeditor.js\"></script>\n	<script>\n        function addSpec(content)\n{\n    document.getElementById(\"redmsg\").innerHTML = \"\";\n    document.getElementById(\"greenmsg\").innerHTML = \"\";\n    \n    let formData = new FormData();\n    let spec_title = \"\", spec_desc = \"\", obj_name = \"\", cat = \"\", country = \"\", lang = \"\", spec_version = \"\", lfdnr = \"\", ac_classes = \"\", pc_classes = \"\", spec_active = \"\";\n    let last_editor = \"\", releases = \"\", spec_valid_start = \"\", spec_valid_end = \"\", spec_content  = \"\"; g_legacy = \"\"; resp = \"\"; comment = \"\"; marker = \"\";\n    var x = document.getElementById(\"addSpec\");\n    var i;\n\n    var text = true;\n    \n    // document.getElementById(\"redmsg\").innerHTML += \"main spec_content:<br>\" + document.getElementById(\"editor\").value;\n    \n    for (i = 0; i < x.length ;i++) \n    {\n        if(x.elements[i].name != \"content\" || x.elements[i].id !== '' || x.elements[i].id !== null || x.elements[i].name !== '')\n        {\n            let id = document.getElementById(x.elements[i].id);\n            try{\n                if (!id.checkValidity())\n                {\n                    document.getElementById(\"redmsg\").innerHTML += \"<p><b>\" + id.validationMessage + \"</b></p>\";\n                    id.className = \"w3-border-red\";\n                    text = false;\n                }\n            }\n            catch(ERR){\n                console.log(\"validation err \" + x.elements[i].name + \" \" + x.elements[i].id + \": \" + ERR);\n            }\n            \n            if(x.elements[i].name == \"spec_title\" && x.elements[i].value !== '')\n            {\n                spec_title = x.elements[i].value;\n            }\n            else if(x.elements[i].name == \"spec_title\" && x.elements[i].value === '')\n            {\n                document.getElementById(\"redmsg\").innerHTML += x.elements[i].name;\n                text = false;\n            }\n            \n            if(x.elements[i].name == \"spec_desc\" && x.elements[i].value !== '')\n            {\n                spec_desc = x.elements[i].value;\n            }\n            else if(x.elements[i].name == \"spec_desc\" && x.elements[i].value === '')\n            {\n                document.getElementById(\"redmsg\").innerHTML += x.elements[i].name;\n                text = false;\n            }\n            \n            if(x.elements[i].name == \"cbobj\" && x.elements[i].checked)\n            {\n               	if(x.elements[i].id === 'objAllgemein')\n				{\n					obj_name += 'General,';\n				}\n				else\n				{\n					obj_name += x.elements[i].id + \",\";\n				}\n            }\n            \n            if(x.elements[i].name == \"cat\")\n            {\n                cat = x.elements[i].value;\n            }\n            \n            if(x.elements[i].name == \"country\" && x.elements[i].value !== '')\n            {\n                country = x.elements[i].value;\n            }\n            else if(x.elements[i].name == \"country\" && x.elements[i].value === '')\n            {\n                document.getElementById(\"redmsg\").innerHTML += x.elements[i].name;\n                text = false;\n            }\n            \n            if(x.elements[i].name == \"lang\")\n            {\n                lang = x.elements[i].value;\n            }\n            \n            if(x.elements[i].name == \"spec_version\" && x.elements[i].value !== '')\n            {\n                spec_version = x.elements[i].value;\n            }\n            else if(x.elements[i].name == \"spec_version\" && x.elements[i].value === '')\n            {\n                document.getElementById(\"redmsg\").innerHTML += x.elements[i].name;\n                text = false;\n            }\n            \n            if(x.elements[i].name == \"lfdnr\" && x.elements[i].value !== '')\n            {\n                lfdnr = x.elements[i].value;\n            }\n            else if(x.elements[i].name == \"lfdnr\" && x.elements[i].value === '')\n            {\n                document.getElementById(\"redmsg\").innerHTML += x.elements[i].name;\n                text = false;\n            }\n            \n            if(x.elements[i].name == \"ac_class\" && x.elements[i].checked)\n            {\n                /*\n                let ac = x.elements[i].id;\n                let acs = ac.split(\"AC-\");\n                ac_classes += acs[1] + \",\";\n                */\n                ac_classes += x.elements[i].value + \",\"; \n            }\n            \n            if(x.elements[i].name == \"pc_class\" && x.elements[i].checked)\n            {\n				/*\n                let pc = x.elements[i].id;\n                let pcs = pc.split(\"PC-\");\n                pc_classes += pcs[1] + \",\";\n                */\n                pc_classes += x.elements[i].value + \",\"; \n            }\n            \n            if(x.elements[i].name == \"releases\")\n            {\n                releases = x.elements[i].value;\n            }\n            \n            if(x.elements[i].name == \"spec_valid_start\")\n            {\n                spec_valid_start = x.elements[i].value;\n            }\n                      \n            if(x.elements[i].name == \"spec_valid_end\")\n            {\n                spec_valid_end = x.elements[i].value;\n            }\n            \n            if(x.elements[i].name == \"spec_active\" && x.elements[i].checked)\n            {\n                spec_active = \"1\";\n            }\n            else if(x.elements[i].name == \"spec_active\" && x.elements[i].checked == false)\n            {\n                spec_active = \"0\";\n            }\n            \n            if(x.elements[i].name == \"last_editor\")\n            {\n                last_editor = x.elements[i].value;\n            }\n            \n            if(x.elements[i].name == \"legacy\" && x.elements[i].checked)\n            {\n                g_legacy += x.elements[i].id + \",\";\n            }\n            \n            if(x.elements[i].name == \"resp\")\n            {\n                resp = x.elements[i].value;\n            }\n            \n            if(x.elements[i].name == \"comment\")\n            {\n                comment = x.elements[i].value;\n            }\n            \n            if(x.elements[i].name == \"marker\")\n            {\n                marker = x.elements[i].value;\n            }\n        }\n    }\n    if(obj_name.length <= 1)\n    {\n        document.getElementById(\"redmsg\").innerHTML += \"<p><b>bitte ein od. mehrere Objekt(e) ausw&auml;hlen</b></p>\";\n        document.getElementById(\"fsobjects\").className = \"w3-border-red\";\n        text = false;\n    }\n    if(ac_classes.length <= 1)\n    {\n        document.getElementById(\"redmsg\").innerHTML += \"<p><b>bitte eine od. mehrere Verf&uuml;gbarkeitsklasse(n) ausw&auml;hlen</b></p>\";\n        document.getElementById(\"fsac_classes\").className = \"w3-border-red\";\n        text = false;\n    }\n    if(pc_classes.length <= 1)\n    {\n        document.getElementById(\"redmsg\").innerHTML += \"<p><b>bitte eine od. mehrere Protection class(es) ausw&auml;hlen</b></p>\";\n        document.getElementById(\"fspc_classes\").className = \"w3-border-red\";\n        text = false;\n    }\n    \n    spec_content = content;\n    \n    //document.getElementById(\"redmsg\").innerHTML += text;\n    \n    if(text === false)\n    {\n        return; \n    }\n\n  \n    let data = 0;       \n    data = new URLSearchParams([[\"spec_title\", spec_title], [\"spec_desc\", spec_desc], [\"obj_sname\", obj_name], [\"cat_class\", cat], [\"country\", country], [\"lang\", lang], [\"spec_version\", spec_version],[\"last_editor\", last_editor], [\"spec_active\", spec_active], [\"lfdnr\", lfdnr], [\"ac_classes\", ac_classes], [\"pc_classes\", pc_classes], [\"spec_release\", releases], [\"spec_content\", spec_content], [\"spec_valid_start\", spec_valid_start], [\"spec_valid_end\", spec_valid_end], [\"g_legacy\", g_legacy], [\"resp\", resp], [\"comment\", comment], [\"marker\", marker]]);\n/*    fetch(\"/StandardsData/setStdData\", {\n    body: data,\n    method: \"post\"\n    });\n*/    \n    \n		fetch(\"/AnnexData/setAnnexData\", { body: data, method: \"post\" })\n		  .then(data => data.json())\n		  .then((json) => \n		  {\n			if(json[0].ERROR === \"0\")\n			{\n				document.getElementById(\"greenmsg\").innerHTML = `<b>Baustein erstellt.</b><br/>Data-ID:<a href=\"/annexdata/show/${json[0].last_data_id}\" title=\"show\">${json[0].last_data_id}</a><br/>Meta-ID: ${json[0].last_meta_id}`;\n				doPopUp(`<p style=\"color: green\"><b>Baustein erstellt.</b><br/>Data-ID: ${json[0].last_data_id}<br/>Meta-ID: ${json[0].last_meta_id}</p>`);\n			}\n			else\n			{\n				document.getElementById(\"redmsg\").innerHTML = \"<b>Baustein <u>nicht</u> erstellt.</b><br/>\" + json[0].ERROR + \" \" + json[0].errMsg ;\n				doPopUp(`<p style=\"color: red\"><b>Baustein <u>nicht</u> erstellt.</b><br/>${json[0].ERROR}<br/>${json[0].errMsg}</p>`);\n			}\n		  })\n		  .catch((error) => { document.getElementById(\"redmsg\").innerHTML = \"Fehler: \" + error + data; });\n/*\n    \n    document.getElementById(\"greenmsg\").innerHTML += \"<br><b>Baustein erstellt.</b>\";\n    if(text === true)\n    {\n        //window.location.href = '/objspecs/editor_add'; \n    }\n*/\n\n}\n\n        \n        ClassicEditor\n			.create( document.querySelector( '.editor' ), {\n				removePlugins: [ 'Title' ],\n                                    simpleUpload: {\n                        // The URL that the images are uploaded to.\n                        uploadUrl: '/annexdata/uploadImg'\n                    },\n                    \n                    heading: {\n            options: [\n                { model: 'paragraph', title: 'Paragraph', class: 'ck-heading_paragraph' },\n                { model: 'heading1', view: 'h1', title: 'Heading 1', class: 'ck-heading_heading1' },\n                { model: 'heading2', view: 'h2', title: 'Heading 2', class: 'ck-heading_heading2' },\n                { model: 'heading3', view: 'h3', title: 'Heading 3', class: 'ck-heading_heading3' },\n                { model: 'heading4', view: 'h4', title: 'Heading 4', class: 'ck-heading_heading4' }\n            ]\n        },\n				toolbar: {\n					items: [\n						'heading',\n						'|',\n						'fontFamily',\n						'fontSize',\n						'fontColor',\n						'|',\n						'bold',\n						'underline',\n						'fontBackgroundColor',\n						'italic',\n						'highlight',\n						'|',\n						'bulletedList',\n						'numberedList',\n						'indent',\n						'outdent',\n						'alignment',\n						'|',\n						'blockQuote',\n						'code',\n						'codeBlock',\n						'insertTable',\n						'|',\n						'link',\n						'imageUpload',\n						'mediaEmbed',\n						'undo',\n						'redo'\n					],\n                    \n				},\n				language: 'de',\n				image: {\n					toolbar: ['imageTextAlternative', 'imageStyle:full', 'imageStyle:alignLeft', 'imageStyle:alignCenter', 'imageStyle:alignRight'],\n                    styles: ['full', 'alignLeft', 'alignCenter', 'alignRight'],\n                    upload: {\n						panel: {\n							items: [ 'insertImageViaUrl' ]\n							}\n						}\n				},\n				table: {\n					contentToolbar: [\n						'tableColumn',\n						'tableRow',\n						'mergeTableCells',\n						'tableCellProperties',\n						'tableProperties'\n					]\n				},\n				licenseKey: '',\n				\n			} )\n			.then( editor => {\n				window.editor = editor;\n				\n			} )\n			.catch( error => {\n				console.error( 'Oops, something gone wrong!' );\n				console.error( 'Please, report the following error in the https://github.com/ckeditor/ckeditor5 with the build id and the error stack trace:' );\n				console.warn( 'Build id: i2w79xgbp58m-q6fhvztvacln' );\n				console.error( error );\n			} );\n            \n           //console.log(ClassicEditor.builtinPlugins.map( plugin => plugin.pluginName ));\n           //document.querySelector( '#submit' ).addEventListener( 'click', () => {const editorData = editor.getData(); document.getElementById(\"editor\").value = editorData;} );\n           document.getElementById(\"speichern\").addEventListener(\"click\", () => {const editorData = editor.getData(); addSpec(editorData)});\n           document.getElementById(\"submit\").addEventListener(\"click\", () => {const editorData = editor.getData(); addSpec(editorData)});\n	</script>\n\n<hr>\n\n<section style=\"border-radius: 0px 0px 0.5em 0.5em\">\n	<button id=\"gallery\" onclick=\"myFunction('Images')\" class=\"w3-button w3-block w3-light-grey w3-left-align w3-border-grey\"><img src = \"/Icons/images.svg\"/> &nbsp;Annex Gallery &nbsp; <img id=\"icongal\" src=\"/Icons/chevron-double-down.svg\"/></button>\n\n<script>\nfunction myFunction(id)\n{\n  const x = document.getElementById(id);\n  const icongal = document.getElementById(\"icongal\");\n  if (x.className.indexOf(\"w3-show\") == -1) \n  {\n    x.className += \" w3-show\";\n    icongal.setAttribute(\"src\", \"/Icons/chevron-double-up.svg\");\n  } \n  else \n  { \n    x.className = x.className.replace(\" w3-show\", \"\");\n  	icongal.setAttribute(\"src\", \"/Icons/chevron-double-down.svg\");\n  }\n}\n</script>      \n\n<div id=\"Images\" class=\"w3-hide\">\n\n<p>URL Text kopieren um in den Baustein via IMG-URL einzufügen.</p>\n\n<!--\n<div class=\"responsive\">\n  <div class=\"gallery\">\n    <a target=\"_blank\" href=\"/Test/1.png\">\n      <img src=\"/Test/1.png\" alt=\"Cinque Terre\" width=\"600\" height=\"400\">\n    </a>\n    <div class=\"desc\">Add a description of the image here</div>\n  </div>\n</div>\n-->\n\n<div class=\"clearfix\"></div>\n</div>\n</section>\n<hr>\n\n</main>\n\n<script>getGalleryImgs();</script>\n\n<itis-footer id=\"itisFooter\" message=\"\"></itis-footer>\n\n<script>\n	document.getElementById(\"close-dialog\").addEventListener(\"click\", () => { document.getElementById(\"dialog\").close(); });\n	document.getElementById(\"intlinks\").addEventListener(\"click\", () => { open_comment(); });\n</script>\n  \n</body>\n</html>\n");

  return responsebody;
}

T_DEFINE_VIEW(annexdata_editor_addView)

#include "annexdata_editor_addView.moc"
